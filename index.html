<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Presentation Manager</title>

  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Lucide icons (UMD) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <!-- Tailwind CDN (ok for demo) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <!-- =========  YOUR APP  ========= -->
  <script>
    /* global React, ReactDOM, Lucide */
    const { useState, useEffect } = React;
    const { Upload, FileText, Download, Trash2, Eye, Search, Folder, Lock, LogOut } = Lucide;

    function PresentationManager() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [password, setPassword] = useState('');
      const [presentations, setPresentations] = useState([]);
      const [searchTerm, setSearchTerm] = useState('');
      const [filter, setFilter] = useState('all');
      const [loading, setLoading] = useState(false);
      const [uploading, setUploading] = useState(false);
      const [error, setError] = useState('');

      // CHANGE THIS to your real Railway URL
      const API_URL = 'https://presentation-manager-backend-production-2f36.up.railway.app';

      useEffect(() => {
        if (isAuthenticated) loadPresentations();
      }, [isAuthenticated]);

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        try {
          const res = await fetch(`${API_URL}/auth`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password })
          });
          const data = await res.json();
          if (data.success) {
            setIsAuthenticated(true);
            sessionStorage.setItem('auth', 'true');
          } else setError('Invalid password');
        } catch {
          setError('Connection error.');
        }
      };

      const loadPresentations = async () => {
        setLoading(true);
        try {
          const res = await fetch(`${API_URL}/presentations`);
          const data = await res.json();
          setPresentations(data.files || []);
        } catch {
          setError('Failed to load presentations');
        }
        setLoading(false);
      };

      const handleFileUpload = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
          if (file.size > 100 * 1024 * 1024) {
            alert(`${file.name} is too large (max 100 MB)`);
            continue;
          }
          setUploading(true);
          const body = new FormData();
          body.append('file', file);
          try {
            const res = await fetch(`${API_URL}/upload`, { method: 'POST', body });
            const data = await res.json();
            if (data.success) await loadPresentations();
            else alert(`Upload failed for ${file.name}`);
          } catch {
            alert(`Error uploading ${file.name}`);
          }
        }
        setUploading(false);
        e.target.value = '';
      };

      const deletePresentation = async (filename) => {
        if (!confirm('Delete this presentation?')) return;
        try {
          const res = await fetch(`${API_URL}/delete/${encodeURIComponent(filename)}`, { method: 'DELETE' });
          const data = await res.json();
          if (data.success) await loadPresentations();
          else alert('Delete failed');
        } catch {
          alert('Error deleting file');
        }
      };

      const downloadPresentation = (filename) =>
        window.open(`${API_URL}/download/${encodeURIComponent(filename)}`, '_blank');

      const viewPresentation = (filename) => downloadPresentation(filename);

      const handleLogout = () => {
        setIsAuthenticated(false);
        setPassword('');
        setPresentations([]);
        sessionStorage.removeItem('auth');
      };

      const formatFileSize = (b) =>
        b < 1024 ? b + ' B' : b < 1048576 ? (b / 1024).toFixed(1) + ' KB' : (b / 1048576).toFixed(1) + ' MB';

      const formatDate = (d) => {
        const date = new Date(d);
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      };

      const filtered = presentations.filter((p) => {
        const byName = p.name.toLowerCase().includes(searchTerm.toLowerCase());
        const byType =
          filter === 'all' ||
          (filter === 'presentation' && /.(ppt|pptx)$/i.test(p.name)) ||
          (filter === 'pdf' && p.name.toLowerCase().endsWith('.pdf'));
        return byName && byType;
      });

      /* ---------------- LOGIN SCREEN ---------------- */
      if (!isAuthenticated)
        return React.createElement(
          'div',
          { className: 'min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center p-6' },
          React.createElement(
            'div',
            { className: 'bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md' },
            React.createElement(
              'div',
              { className: 'text-center mb-8' },
              React.createElement(
                'div',
                { className: 'inline-flex items-center justify-center w-20 h-20 bg-indigo-100 rounded-full mb-4' },
                React.createElement(Lock, { className: 'text-indigo-600', size: 40 })
              ),
              React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-2' }, 'Presentation Manager'),
              React.createElement('p', { className: 'text-gray-600' }, 'Enter password to access your presentations')
            ),
            React.createElement(
              'form',
              { onSubmit: handleLogin },
              React.createElement(
                'div',
                { className: 'mb-6' },
                React.createElement('label', { className: 'block text-gray-700 font-semibold mb-2' }, 'Password'),
                React.createElement('input', {
                  type: 'password',
                  value: password,
                  onChange: (e) => setPassword(e.target.value),
                  className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent',
                  placeholder: 'Enter password',
                  required: true
                })
              ),
              error && React.createElement(
                'div',
                { className: 'mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm' },
                error
              ),
              React.createElement(
                'button',
                { type: 'submit', className: 'w-full bg-indigo-600 text-white py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors font-semibold' },
                'Access Presentations'
              )
            )
          )
        );

      /* ---------------- MAIN APP ---------------- */
      return React.createElement(
        'div',
        { className: 'min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50' },
        React.createElement(
          'div',
          { className: 'max-w-7xl mx-auto p-6' },
          /* header card */
          React.createElement(
            'div',
            { className: 'bg-white rounded-2xl shadow-lg p-8 mb-6' },
            React.createElement(
              'div',
              { className: 'flex items-center justify-between mb-4' },
              React.createElement(
                'div',
                null,
                React.createElement(
                  'h1',
                  { className: 'text-4xl font-bold text-gray-800 flex items-center gap-3' },
                  React.createElement(Folder, { className: 'text-indigo-600', size: 40 }),
                  'My Presentations'
                ),
                React.createElement('p', { className: 'text-gray-600 mt-2' }, 'Access your presentations from anywhere, anytime')
              ),
              React.createElement(
                'div',
                { className: 'flex items-center gap-4' },
                React.createElement(
                  'div',
                  { className: 'text-right' },
                  React.createElement('div', { className: 'text-3xl font-bold text-indigo-600' }, presentations.length),
                  React.createElement('div', { className: 'text-sm text-gray-600' }, 'Total Files')
                ),
                React.createElement(
                  'button',
                  { onClick: handleLogout, className: 'flex items-center gap-2 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors' },
                  React.createElement(LogOut, { size: 20 }),
                  'Logout'
                )
              )
            ),
            /* upload area */
            React.createElement(
              'label',
              { className: 'block' },
              React.createElement('input', {
                type: 'file',
                multiple: true,
                accept: '.ppt,.pptx,.pdf,.key,.odp',
                onChange: handleFileUpload,
                disabled: uploading,
                className: 'hidden'
              }),
              React.createElement(
                'div',
                { className: `border-2 border-dashed border-indigo-300 rounded-xl p-8 text-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 transition-all ${uploading ? 'opacity-50 cursor-not-allowed' : ''}` },
                React.createElement(Upload, { className: 'mx-auto text-indigo-600 mb-3', size: 48 }),
                React.createElement('p', { className: 'text-lg font-semibold text-gray-700' }, uploading ? 'Uploading...' : 'Click to upload presentations'),
                React.createElement('p', { className: 'text-sm text-gray-500 mt-1' }, 'Supports PPT, PPTX, PDF, KEY, ODP (Max 100MB per file)')
              )
            )
          ),

          /* search / filter bar */
          React.createElement(
            'div',
            { className: 'bg-white rounded-2xl shadow-lg p-6 mb-6' },
            React.createElement(
              'div',
              { className: 'flex flex-col md:flex-row gap-4' },
              React.createElement(
                'div',
                { className: 'flex-1 relative' },
                React.createElement(Search, { className: 'absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400', size: 20 }),
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Search presentations...',
                  value: searchTerm,
                  onChange: (e) => setSearchTerm(e.target.value),
                  className: 'w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent'
                })
              ),
              React.createElement(
                'select',
                {
                  value: filter,
                  onChange: (e) => setFilter(e.target.value),
                  className: 'px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent'
                },
                React.createElement('option', { value: 'all' }, 'All Types'),
                React.createElement('option', { value: 'presentation' }, 'PowerPoint'),
                React.createElement('option', { value: 'pdf' }, 'PDF')
              )
            )
          ),

          /* grid */
          React.createElement(
            'div',
            { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
            loading
              ? React.createElement('div', { className: 'col-span-full text-center py-12 text-gray-500' }, 'Loading presentations...')
              : filtered.length === 0
              ? React.createElement(
                  'div',
                  { className: 'col-span-full text-center py-12' },
                  React.createElement(FileText, { className: 'mx-auto text-gray-400 mb-4', size: 64 }),
                  React.createElement('p', { className: 'text-gray-500 text-lg' }, 'No presentations found'),
                  React.createElement('p', { className: 'text-gray-400 text-sm mt-2' }, 'Upload your first presentation to get started')
                )
              : filtered.map((p) =>
                  React.createElement(
                    'div',
                    { key: p.name, className: 'bg-white rounded-xl shadow-md hover:shadow-xl transition-all p-6' },
                    React.createElement(
                      'div',
                      { className: 'flex items-start justify-between mb-4' },
                      React.createElement(FileText, { className: 'text-indigo-600', size: 40 }),
                      React.createElement(
                        'button',
                        { onClick: () => deletePresentation(p.name), className: 'text-red-500 hover:bg-red-50 p-2 rounded-lg transition-colors' },
                        React.createElement(Trash2, { size: 20 })
                      )
                    ),
                    React.createElement('h3', { className: 'font-semibold text-gray-800 mb-2 truncate', title: p.name }, p.name),
                    React.createElement(
                      'div',
                      { className: 'text-sm text-gray-500 space-y-1 mb-4' },
                      React.createElement('p', null, 'Size: ' + formatFileSize(p.size)),
                      React.createElement('p', null, 'Uploaded: ' + formatDate(p.uploadDate))
                    ),
                    React.createElement(
                      'div',
                      { className: 'flex gap-2' },
                      React.createElement(
                        'button',
                        { onClick: () => viewPresentation(p.name), className: 'flex-1 flex items-center justify-center gap-2 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors' },
                        React.createElement(Eye, { size: 18 }),
                        'View'
                      ),
                      React.createElement(
                        'button',
                        { onClick: () => downloadPresentation(p.name), className: 'flex-1 flex items-center justify-center gap-2 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors' },
                        React.createElement(Download, { size: 18 }),
                        'Download'
                      )
                    )
                  )
                )
          )
        )
      );
    }

    /* =========  MOUNT APP  ========= */
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(PresentationManager));
  </script>
</body>
</html>
